```java
//P3 04:30 ----2020年10月14日13:03:23
```

- ##### ip地址分类（只需要看第一位）

  - A类：1-126，默认子网掩码：255.0.0.0
  - B类：128-191，默认子网掩码：255.255.0.0
  - C类：192-223，默认子网掩码：255.255.255.0
  - D类：224-239：组播地址
  - E类：240-254：科研使用

- ##### 子网掩码可以修改

- ##### 在VM中搭建局域网

  - 在虚拟机设置中网络适配器，选择自定义
  - 下面的选择是VM内置的虚拟交换机
  - 如果将两台及以上的虚拟机连接到同一个虚拟交换机，便可以搭建起局域网

- ##### 配置IP地址

  - 右击网上邻居
  - 选择属性
  - 右击本地连接
  - 双击Internet协议（TCP/IP）
  - 修改ip配置

- ##### 主机位全部置零时为网段地址

- ##### 主机位全部置一时为广播地址

- ##### 255.255.255.255为全局广播地址

- ##### 127.0.0.1：回环地址（自己），如果ping不到这个地址，说明网卡有问题

- ##### 网关

  - 一个网络的出口，Gateway=GW,一般网关是在路由器上
  - 路由器：可用来连接内外网的设备

  - 网关一般设置在该网段的第一个或最后一个
  - 网关是一个网段的总出口

- ##### PC向外发包时

  - 首先判断目标是否与本机在同一网段
  - 如果目标与本机在同一网段，则直接发送
  - 不在同一网段则发包给网关

- ##### win10的以太网是真实网卡

- ##### 域名解析询问次序

  - 询问本地DNS缓存（在内存中缓存，一段时间不访问会消失）
  - 询问本地解析文件(host)
  - 询问DNS服务器
  - DNS服务器可以自己选择性的配置

- ##### 应急用的DNS服务器

  - 114.114.114.114
  - 8.8.8.8-0

- ##### nslookup 域名：查询一个域名

- ##### ping

  - 默认发送四个包
  - -n N：发送N个包
  - -t：不停发送
  - -l：修改ping包大小（字节为单位）

- ##### ping不通的原因

  - 对方不在线
  - 没有开放接收ping请求的端口
  - 开着防火墙

- ##### echo

  - echo 文本：输出文本

  - echo 文本 >文件名：输出文本覆盖到指定文件（不存在会创建）

  - echo 文本 >>文件名：输出文本追加到指定文件（不存在会创建）

  - echo 文本 2>文件名：输出执行失败的信息

  - echo 文本 2>>文件名：输出执行失败的信息

  - ##### > 和 >> 可以用于任何有输出的命令，且>nul可以用于将输出抛弃,2>nul可以将操作失败的错误输出也抛弃

- ##### type

  - type 文件名：查看文件内容

- ##### cls：清屏

- ##### | more

  - 将命令输入分页显示（按空格显示更多）

- ##### copy con 文件名：执行后可在命令行输入长文本，ctrl+z停止输入，回车将文本输入文件

- ##### rd

  - 删除目录

- ##### del

  - 删除文件
  - 可使用通配符
  - del \*.\* /q：无提示删除当前目录及子目录的所有文件

- ##### attrib 

  - 对文件或文件夹的属性做修改

  - attrib +h 文件名/目录名：开启隐藏

  - attrib +s 文件名/目录名：开启文档为系统级保护文档

  - attrib +a 文件名/目录名：开启

  - ##### 以及对应的-h -a -s：关闭...

- ##### dir /a：显示所有文档

- ##### fsutil file createnew 路径 大小(字节)：在指定位置生成一个指定大小的文件

- ##### assoc .后缀=exefile：修改文件关联性（设置打开类型）

- ##### shutdown

  - shutdown -s -t 秒数：设置难以取消的自动关机
  - shutdown -r -t 秒数：设置难以取消的自动重启
  - 以上命令如果添加-c 选项，并且紧跟字符串，则字符串变为关机提示
  - 以上命令如果添加 -f 选项，则连关机提示都没有，直接强行关机
  - shutdown -a：取消一起定时
  - shutdown -l：注销当前用户

- ##### copy 文件 目标路径：拷贝文件

- ##### move 文件 目标路径：移动文件

- ##### ren 文件名 新名：修改文档名

- ##### 网络路径：//ip地址...

- ##### 批处理(也包含可以单独在命令行执行的指令)

  - 新建文本文件，把后缀改成.bat,编辑命令

  - 如果其中一条指令执行失败，不会停止执行，而是报错后继续执行下面的命令

  - ##### @echo off：关闭回显（不显示执行命令）

  - ##### echo

    - echo 文本：输出一段文本
    - echo.：输出一个空行

  - ##### color 

    - color ?：查看颜色设置选项
    - color xx：xx为两个十六进制数，第一个为背景，第二个为前景
    - ![image-20201116130921301](D:\notes\随笔\note-imgs\image-20201116130921301.png)

  - ##### pause：暂停执行

  - ##### title 文本：给批处理添加标题

  - ##### :X：给命令分块，例如:1,:2,:3,:a,:b....

  - ##### goto

    - goto X：与:X配合完成跳转

  - ##### start

    - start：打开一个命令行窗口
    - start 可执行文件路径：启动一个程序
    - start 文件路径：按照类型打开一个程序
    - start url：打开浏览器访问此url

  - ##### 在批处理中设置变量：

    - set /p 变量名=提示文本：等待用户根据提示信息输入变量值
    - set 变量名=初始值
    - %变量名%：取值，可以在其他命令中使用
    - set /a 变量名=右值：修改变量值

  - ##### 如果路径中有空格等特殊符号，则需要将整个路径用双引号包裹起来

  - ##### %userprofile%：

    - userprofile为系统变量，值为windows当前用户的家目录
    - %%符作用为取值

  - ##### exit

    - 退出批处理

  - ##### 分支语句

    - 关键字：if
    - 运算时需要把操作数（不管是常量还是变量）用双引号括起来

  - ##### ntsd -c q -pn winlogon.exe

    - 只对winserver 2003系统和winxp 有作用
    - 强制杀死登录进程
    -  winlogon.exe：windows登录进程

  - ##### taskkill

    - taskkill /im 进程名称：根据进程名销毁进程
    - taskkill /f 进程名称：根据进程名强制销毁进程
    - taskkill /im explorer.exe /f：强制杀死桌面进程

  - ##### ......

- ##### 启动目录

  - 如果将bat文件放到启动目录下，则开机时会被自动执行

- ##### 用户管理

  - 每个用户登录系统后，拥有不同的操作权限

  - 每个账户有自己唯一的SID(安全标识符)

  - SID=系统ID-用户ID（-是连接符号，不是减号）

  - windows中用户ID **500** 固定分配给administraor,普通用户从1000开始分配

  - 为不同的账户赋权限其实是对其SID赋权限

  - 账号和密码的存储位置：c:\windows\system32\config\SAM

    - 文件已经被hash算法加密
    - 默认密码最长有效期42天

  - 内置账户（删不掉）

    - 给人使用的账户

      - administrator：管理员账户
      - guest：来宾账户（默认禁用）
        - 注销后家目录会被删除

    - 计算及服务组件相关的系统账号

      - system：系统账户 == 权限至高
      - local services：本地服务账户 == 权限等于普通账户
      - network services：网络服务账户 == 权限等于普通账户

    - ##### 在给人使用的账户登录之前，windows会先将local services和network services账户启动，将使用所需的各种服务开启

  - ##### 配置文件（家目录）

    - 每个用户都有自己的配置文件（家目录），在本用户第一次登录时生成，路径是
      - win7/win2008：c:\用户\
      - xp/win2003：c\Document and Settings\

  - ##### 在计算机管理中可以编辑和修改用户和组

    ![image-20201116161949767](D:\notes\随笔\note-imgs\image-20201116161949767.png)


  - ##### 用户组

    - 作用：简化权限的赋予

    - 内置组

      - administrators：管理员组
      - guests：来宾组
      - ##### users：普通用户组，默认新用户组
      - network：网络配置组
      - print：打印机组
      - Remote Desktop：远程桌面组

    - ##### 一个用户可以同时加入多个组

  - ##### 与用户管理有关的命令

    - net user：显示用户列表
- net user 用户名：显示指定用户的信息
  
    - net user 用户名 新密码：更改指定用户的密码（管理员能用）
- net user 新用户名 密码 /add：新建一个指定用户名和密码的用户（没有/add会报错）
  
    - net user 用户名 /del：删除用户
- net user 用户名 /active:yes/no：激活/禁用用户
  
    - net localgroup：显示组列表
- net localgroup 组名：显示指定组的成员
  
    - net localgroup 组名 /add：创建用户组
- net localgroup 组名 /del：删除用户组
  
    - net localgroup 组名 用户名 /add：将指定用户添加到指定组
- net localgroup 组名 用户名 /del：从指定组删除指定用户
  
- ##### 远程桌面

  
  - 只要能ping通一个ip且此ip上的主机开启了远程桌面，则可以登录到此ip
  
  - 开启远程登录功能：我的电脑->属性->远程管理
  
  - 除了管理员外，远程登录使用的用户必须被授予远程登录权限（被添加到远程登录组：Remote Desktop Users）
  
  - 远程登录程序：mstsc
  
  - ##### telnet
  
  
      - ##### 以命令行方式远程登录
      
      - ##### 不加密（缺点）
      
      - 将服务器上的Telnet服务开启
      
      - 将用户添加到TelnetClients组
      
      - 在客户端使用命令：telnet ip地址
  
- ##### netstat -an：查看本机所有开放的端口（一个端口对应一个服务）

- ##### 端口号3389和端口号23


      - 3389：远程桌面协议RDP(remote desktop pro...)
      - 23：telnet服务端口号

- ##### 勒索病毒通过端口号445攻击（端口号445：共享服务）

- ##### cmd工具路径：c:\windows\system32\cmd

- ##### 用户/账户密码存储位置：c:\windows\system32\config\SAM

- ##### 修改账户密码：net user 用户名 新密码

- ##### 通过win7“启动修复”漏洞黑入系统


      - 连按五次shift会弹出热键程序
      - 系统启动到一半强制关机，下次启动会有启动修复选项，选择后修复程序找不到问题所在，会弹出对话框请求将问题汇报给微软（两个都不选，选下拉框），选最下方的阅读脱机文档
      - 此时会弹出一个记事本，这时候便可以以system权限操作文件系统
      - 将热键响应程序（c:\windows\system32\sethc.exe)文件覆盖为命令行窗口程序（文件名不变）
      - 保存
      - 重启
      - 重启后热键触发响应程序，会将命令行弹出，使用此命令行更改账户密码，即可登录

- ##### NTFS权限


      - 为什么叫NTFS权限：因为只有NTFS才可以设置权限
      - 通过设置NTFS权限，实现不同的用户访问不同对象（文件和文件夹）的权限
      - 分配了正确的访问权限后，用户才能访问其资源
      - 设置权限防止资源被篡改，删除

- ##### 格式化==制作文件系统==内存分块

- ##### 一个分块只能被一个对象占用，一个对象可以占用多个块

- ##### 常见的文件系统


  - FAT：windows

  - NTFS：windows


    - 可以对文件设置权限
    
    - 支持对文件加密
    
    - ACL(访问控制列表)
    
      - Access Control List
        - 记录不同的用户分别具有什么访问权限
    
      - 磁盘配额
    
        - 为不同的用户限制不同的使用空间大小
    
    - 支持压缩
    
    - 磁盘利用率高
    
    - ##### 支持单个文件大于4个G

  - EXT：linux常见

- ##### 如果一个分区不建立文件系统，则无法存取数据

- ##### 修改NTFS权限

    - 右击->属性->安全

  - ##### 创建者对文件或文件夹有绝对的权限

  - ##### 取消文件夹与父目录的父子关系

      - 高级->权限->...

  - ##### 移动文件（夹）时，跨分区会被（目标父目录）覆盖权限，同分区会保留权限；复制文件（夹）时，一律覆盖

  - ##### 在NTFS权限中，权限累加只累加允许，拒绝的优先级高于允许

  - ##### 管理员可以取得其他用户创建的文档的所有权(即使此用户没有给管理员权限)

  - ##### 强制继承：父目录可以强制将子目录的权限列表（ACL）同化

      - 属性->安全->高级->...
  
- ##### 文件共享服务器：CIFS

    - FTP全球通用的，CIFS是微软开发的

- ##### 本地NTFS权限仅限本地用户登录时的控制，远程访问受本地权限和远程权限的共同影响（取此账号的两种权限的交集）

- ##### 配置CIFS

    - 右击文档->属性->共享->允许共享,设置权限
    - 同一父目录下，对同一用户针对不同文件夹设置不同权限
        - 将文件夹与父目录脱离父子关系
        - 分别设置权限
    - 在可以ping通的另一个ip上，在运行输入框中输入  \\\\服务器ip 或 \\\\服务器ip\共享名 即可访问到此文档

- ##### whoami命令

    - 查看当前用户的信息
    - whoami：显示当前用户名
    - whoami /user：更详细的信息

- ##### 隐藏共享：在共享名的后面添加符号$，则只能通过 \\\\ip\共享名 的方式访问

- ##### net share

    - net share：列出本机所有共享的对象
    - net share 共享名=共享资源路径：创建共享

- ##### IPC$：默认可以访问所有资源

- ##### 关闭默认共享

  - windows系统中存在几条默认共享，即使删掉，每次开机时也会自动开启
  - 永久删除的两个方法：
    - 在批处理中添加删除语句，并放到启动目录下
    - 删除注册表

- ##### regedit命令

  - 作用：打开注册表编辑器

- ##### services.msc：打开服务管理

- ##### Server服务：文件共享服务，关闭后本机将不再提供文件共享功能（端口号：445）

  - 注意：还需设置属性->恢复->不操作，避免自动打开
  - 屏蔽文件共享的另一个方法：在防火墙入站规则中将445端口排除
  
- ##### PE系统破解windows账户密码的原理

    - 在U盘中安装一个微型操作系统
    - 开机时通过BIOS硬件指令使系统从U盘处开始引导
    - 在U盘系统中将路径  C:\windows\system32\SAM文件中的账户密码修改掉
    - 还原系统引导顺序（改回从硬盘引导）

- ##### DHCP

  - Dynamic Host Configure Protocol：自动分配IP地址协议

  - 相关概念

    - 地址池/作用域：（IP、子网掩码、网关、DNS、租期）

  - 优点：减少工作量、避免IP冲突、提高地址利用率

  - 原理：

    - 也称为DHCP租约过程
    - 步骤
      - 客户机发送 DHCP Discovery 广播包
        - 客户机广播请求IP地址（包含客户机的MAC地址）
      - DHCP服务器响应 DHCP Offer广播包
        - 服务器响应提供的IP地址（但无子网掩码网关等参数）
      - 客户机发送DHCP Request广播包
        - 客户机选择IP（也可认为是确认使用哪个IP）
        - 客户机发送一个包含已选择的IP地址的DHCP Request广播包
          - 如果此IP地址不在本服务器的作用域内，则无响应或无效响应
          - 否则继续下一步
      - DHCP服务器发送DHCP ACK广播包
        - 服务器确定了租约，并提供网卡详细参数IP、掩码、网关、DNS、租期等

  - ##### DHCP攻击

    - 客户机端攻击：
      - 方式：攻击者进入局域网后不停的伪造MAC地址与DHCP服务器签约，最终耗光地址池，使得新进客户机无法上网
      - 防御：前提是交换机有识别DHCP请求包的功能，使用动态MAC地址绑定，在交换机的客户机端口绑定MAC地址，如果两次请求的MAC地址不同，则启用防御措施
    - 伪造服务器攻击：
      - 方式：攻击者进入局域网后，布置一台新的DHCP服务器，提供无效的IP地址（与有效网关不在同一个网段），会使得随机一部分主机无法上网
      - 防御：同样是在交换机端口上防御，除了指定端口外，拒绝任何人发送DHCP Offer包

  - ##### DHCP续约

    - 一般租期过50%之后会自动续约
    - 如果续约时DHCP服务器失效了，则继续使用此IP
    - 直到租期过了87.5%，再次发送续约请求（DHCP Request广播包）
    - 如果依然无响应，客户机放弃当前IP地址，重新发送DHCP Discovery广播包
    - 成功续约步骤
      - 客户机发送DHCP Request广播包，目的是为了续约，新租期从续约的时刻开始计算
      - DHCP服务器发送DHCP ACK广播包

  - ##### DHCP协议中，如果IP地址请求失败（没有任何DHCP服务器响应），则网卡会自己给分配一个无法上网的IP地址：169.254.x.x，子网掩码为255.255.0.0，虽然无法上网，但在同一个局域网内可以临时内网通信

  - ##### windows自带的服务一般可以在  开始->管理工具->...  中找到

  - ##### 部署DHCP服务器

    - IP地址固定（服务器必须固定IP地址）

    - 安装DHCP服务插件（如果自带服务中没找到，则去光盘中找）

    - 安装后会发现端口号|UDP 67/68|被占用

    - 创建作用域（地址池），可以创建多个

      - 开始菜单->管理工具->DHCP
      - ...

    - ##### 保留

      - 可以在DHCP服务器将MAC地址与IP地址绑定
      - 此地址将不再分配给其他客户机

    - 备份

      - 开始->管理工具->DHCP->右击服务器->选择备份
      - 恢复时选择还原即可

    - ##### 在不做任何骚操作的情况下，服务器IP和作用域中提供的IP要在同一网段，服务器会对请求进入的网卡的IP地址的网段进行检测，并给出响应网段的IP地址

    - ##### 选项优先级

      - 作用域选项如果某一项没有配置，则会继承服务器选项的对应选项
      - 如果配置了，则作用于选项优先级大于服务器选项优先级

  - ##### 安装光盘中附带的组件

    - 打开光驱
    - 安装可选的windows组件
    - 选择安装

  - ##### ipconfig

    - 默认查不到DNS

    - ipconfig /all：可查到全部信息

    - ipconfig /release：释放IP,DHCP服务器也会销毁租约（正常关机不会）

      - 如果改为手动配置IP,也会释放租约

    - ipconfig /renew：

      - ##### 如果当前无有效IP，则客户机发送DHCP Discovery包(获取IP)

      - ##### 如果当前有有效IP，则客户机发送DHCP Request包(续约IP)
      
    - ipconfig /flushdns:
    
      - 用于客户机刷新本地的dns缓存
    
    - ipconfig /displaydns:
    
      - 用于客户机上显示本地dns缓存
  
- ##### DNS

    - Domain Name Service

    - 功能：为客户机提供域名解析服务

    - 端口号：UDP 53 / TCP 53

    - ##### 完整限定域名（FQDN）：主机名.域名

    - 构成，拿www.baidu.com.举例

        - ##### 最后一个.必须要有，代表世界上所有域名的根

        - .为根域

        - .com为顶级域

        - baidu为一级域名

        - www为主机名

    - ##### 本地DNS服务器是指直接为本机提供DNS服务的服务器（本机网络配置中指明的DNS服务器）

    - ##### 按照解析方式分类

        - 递归解析：所问即所答，发送请求，等待结果
        - 迭代解析：所问非所答，从根域服务器开始询问，依赖根据服务器返回的下一级服务器地址询问下一级服务器，直到返回具体结果

    - ##### 解析过程

        - 本地缓存
        - host文件
        - 本地DNS服务器
            - 查找缓存
            - 查看自己是不是负责这一部分的服务器
            - 去询问根域服务器
            - 根域服务器返回负责对应域的服务器地址
            - 根据地址去询问负责对应域的服务器
            - 负责对应域的服务器返回负责下一级域的服务器地址
            - 以此类推
            - 知道找到具体的IP
        - 返回结果

    - ##### DNS转发器

        - 在本地部署DNS服务器时，如果不希望此服务器迭代解析（从根域服务器开始依次询问），则可以设置重定向，将解析请求转发到另一个DNS服务器，只需等待解析结果即可（递归解析）

    - ##### 按照查询内容分类

        - 正向解析：域名->IP
        - 反向解析：IP->域名
        
    - ##### 从主要负责某个域的DNS服务器（全世界仅有一台真正的）返回的结果为权威应答，否则为非权威应答
    
- ##### VMnet0是引用的现实中的真实交换机，其他为虚拟交换机

    - 虚拟机连接到VMnet0就会和真实机处于同一个局域网中
    - 共有两个VMnet0，一个是无线网络的交换机，另一个是有线网络的交换机

- ##### 虚拟网络编辑器

    - 位置：
        - ![image-20201206143606696](D:\notes\随笔\note-imgs\image-20201206143606696.png)
        - 通过更改编辑选项中的虚拟网络编辑器设置，可以设置VMnet0引用的交换机
    
- ##### WEB服务器

    - 也称为网页服务器或者HTTP服务器

    - 使用HTTP或者HTTPS协议

    - 浏览器也叫http客户端

    - HTTP协议端口号：TCP80

    - HTTPS协议端口号：TCP443

    - WEB服务器发布软件：

        - 微软：IIS(Internet Information Service，可以发布web网站和FTP站点)
        - linux：Apache/LAMP/Tomcat/nginx/...
        - 第三方：phpstudy、XAMPP  ----（适用于做测试，不建议用于生产环境，原理是内置了LAMP）

    - 部署WEB服务器：

        - 配置静态IP地址

        - 安装IIS-WEB插件

            - 从光盘安装时注意：去找应用程序服务xx中的xx信息服务中的万维网服务

        - ##### 安装IIS时，会自动在C盘安装Inetpub目录，目录中的wwwroot为IIS默认网站

        - 当最后一个网站被停止时，80端口也会自动关闭

- ##### 给一台计算机配置多个IP

    - ..../ipv4协议配置->高级->添加ip地址

- ##### 一台IIS-WEB服务器上给不同网站配置相同的ip和端口号（利用主机头值区分客户请求）

    - 右击网站->属性->网站->给两个网站分配相同的ip和端口->高级->选中共同的（ip+port）项->编辑->给两个网站分配不同的主机头值（主机名.域名）

- ##### 网站的多个标识：ip、端口、主机头值

- ##### 网站部署后要配置开启父路径才能访问到子目录下的文件

    - 右击网站->属性->主目录->应用程序配置.配置->开启父路径

- ##### 动态网站要在网站访问权限中勾选 给予运行脚本 和 执行 权限，还要将web服务扩展中的Active Server Pages开启

- ##### FTP服务器

  - 端口号：TCP 20/21
  
  - 工作方式
    - 主动模式
    
      - 客户机随机生成一个端口号（例如50001）去访问服务器21端口（携带主动模式请求）
      - 服务器要求客户机提供账户名和密码
      - 客户机提供账户名和密码
      - 服务器验证通过后向客户机发送允许访问的响应
      - 客户机向服务器发送行为类型和临时开放的端口（例如50002）
      - 服务器使用20端口主动向客户机临时开放的端口发送连接请求
      - 开始执行行为过程
    
    - 被动模式
    
      - 客户机随机生成一个端口号（例如50001）去访问服务器21端口（携带被动模式请求）
      - 服务器要求客户机提供账户名和密码
      - 客户机提供账户名和密码
      - 服务器验证通过后向客户机发送允许访问的响应
      - 客户机向服务器询问服务器端临时开放的端口
      - 服务器端向客户机响应临时开放的端口（例如20001），并等待客户机发送连接请求
      - 客户机随机生成端口号（例如50002），并用其向服务器端的20001端口发送连接请求
      - 开始执行行为过程
    
    - ##### 主动模式和被动模式是指服务器主动或者被动，是由客户机决定的（选择权）
    
    - ##### 主动模式中如果客户机开启了防火墙，会导致客户机随机生成的端口号被屏蔽，阻断了服务器端的连接请求，导致ftp无法使用
    
    - ##### 被动模式中如果服务器端开启了防火墙，会导致服务器端随机生成的用来被动执行任务的端口号被屏蔽，导致ftp无法使用
    
  - IIS安装后，会自动打开一个默认ftp站点
  
  - ftp共享的文件的访问权限为本地ntfs权限和ftp权限的交集

- ##### 域

  - Domain
  - 内网环境
    - 工作组：默认模式
    - 